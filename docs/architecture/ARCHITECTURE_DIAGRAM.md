# System Architecture Diagram

## Complete Integration Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Docker Network (gis_network_dev)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    PostgreSQL + PostGIS                          â”‚   â”‚
â”‚  â”‚                    Container: gis_postgres_dev                   â”‚   â”‚
â”‚  â”‚                    Port: 5432                                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Database: gis_carbon                                            â”‚   â”‚
â”‚  â”‚  â”œâ”€ Django tables (people, api, auth, etc.)                     â”‚   â”‚
â”‚  â”‚  â””â”€ MapStore tables (gs_*, created by Hibernate)                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚  Database: gis_carbon_data                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€ Spatial tables (user-created)                                â”‚   â”‚
â”‚  â”‚  â”œâ”€ sample_geometries (demo table)                               â”‚   â”‚
â”‚  â”‚  â””â”€ PostGIS extensions                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Django API    â”‚    â”‚   FastAPI GEE   â”‚    â”‚      Redis      â”‚     â”‚
â”‚  â”‚   Port: 8000    â”‚    â”‚   Port: 8001    â”‚    â”‚   Port: 6379    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ â€¢ REST API      â”‚    â”‚ â€¢ GEE Tiles     â”‚    â”‚ â€¢ Cache         â”‚     â”‚
â”‚  â”‚ â€¢ Auth Service  â”‚    â”‚ â€¢ Calculations  â”‚    â”‚ â€¢ Sessions      â”‚     â”‚
â”‚  â”‚ â€¢ User Mgmt     â”‚    â”‚ â€¢ JWT Verify    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚  â”‚ â€¢ Role Service  â”‚    â”‚ â€¢ GIS Data      â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚           â”‚                      â”‚                                       â”‚
â”‚           â”‚                      â”‚                                       â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                       â”‚
â”‚                      â”‚                                                   â”‚
â”‚                      â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                        GeoServer                               â”‚     â”‚
â”‚  â”‚                   Container: gis_geoserver_dev                 â”‚     â”‚
â”‚  â”‚                   Port: 8080                                   â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  Workspace: gis_carbon                                         â”‚     â”‚
â”‚  â”‚  Datastore: gis_carbon_postgis                                 â”‚     â”‚
â”‚  â”‚             â””â”€> PostgreSQL: gis_carbon_data                    â”‚     â”‚
â”‚  â”‚                                                                 â”‚     â”‚
â”‚  â”‚  Security:                                                      â”‚     â”‚
â”‚  â”‚  â€¢ REST Role Service                                            â”‚     â”‚
â”‚  â”‚    â””â”€> Django API: /api/auth/geoserver/roles/{username}       â”‚     â”‚
â”‚  â”‚  â€¢ Shared Secret: X-Role-Secret                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                         MapStore                               â”‚     â”‚
â”‚  â”‚                   Container: gis_mapstore_dev                  â”‚     â”‚
â”‚  â”‚                   Port: 8082                                   â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚  GeoStore Backend:                                             â”‚     â”‚
â”‚  â”‚  â””â”€> PostgreSQL: gis_carbon (separate tables)                 â”‚     â”‚
â”‚  â”‚                                                                 â”‚     â”‚
â”‚  â”‚  Integrations:                                                  â”‚     â”‚
â”‚  â”‚  â€¢ GeoServer WMS/WFS layers                                     â”‚     â”‚
â”‚  â”‚  â€¢ Django Auth API                                              â”‚     â”‚
â”‚  â”‚  â€¢ Unified JWT tokens                                           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                      Jupyter Lab                               â”‚     â”‚
â”‚  â”‚                   Port: 8888                                   â”‚     â”‚
â”‚  â”‚  â€¢ Development & Testing                                       â”‚     â”‚
â”‚  â”‚  â€¢ Access to all GEE libraries                                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚                                          â”‚ External â”‚
â”‚ Browser  â”‚                                          â”‚   App    â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                                      â”‚
     â”‚ 1. Login Request                                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
     â”‚                            â†“                         â”‚
     â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                    â”‚   MapStore   â”‚                  â”‚
     â”‚                    â”‚  or Django   â”‚                  â”‚
     â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                           â”‚                          â”‚
     â”‚                           â”‚ 2. Validate Credentials  â”‚
     â”‚                           â†“                          â”‚
     â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                    â”‚  Django API  â”‚                  â”‚
     â”‚                    â”‚  /api/auth/  â”‚                  â”‚
     â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                           â”‚                          â”‚
     â”‚ 3. Return JWT             â”‚                          â”‚
     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
     â”‚                           â”‚                          â”‚
     â”‚ 4. Access GeoServer       â”‚                          â”‚
     â”‚    with JWT or Basic      â”‚                          â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                           â†“                          â”‚
     â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                    â”‚  GeoServer   â”‚                  â”‚
     â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                           â”‚                          â”‚
     â”‚                           â”‚ 5. Fetch user roles      â”‚
     â”‚                           â†“                          â”‚
     â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
     â”‚                    â”‚  Django API  â”‚                  â”‚
     â”‚                    â”‚  Role Serviceâ”‚                  â”‚
     â”‚                    â”‚  + Secret    â”‚                  â”‚
     â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                           â”‚                          â”‚
     â”‚ 6. Return Layer Data      â”‚                          â”‚
     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
     â”‚                                                      â”‚
     â”‚ 7. Access FastAPI with JWT                           â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                                      â†“
     â”‚                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                                              â”‚   FastAPI    â”‚
     â”‚                                              â”‚ Validates JWTâ”‚
     â”‚                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                                                      â”‚
     â”‚ 8. Return GEE Tiles                                  â”‚
     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
```

## Data Flow - Creating and Viewing a Layer

```
1. Create Spatial Table
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Developer     â”‚
   â”‚   (psql/pgAdmin)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ CREATE TABLE my_layer...
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   PostgreSQL    â”‚
   â”‚ gis_carbon_data â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚

2. Publish to GeoServer
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  create-        â”‚
   â”‚  datastore.sh   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ REST API
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   GeoServer     â”‚
   â”‚ â€¢ Creates layer â”‚
   â”‚ â€¢ Sets metadata â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚

3. Add to MapStore
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  MapStore UI    â”‚
   â”‚ â€¢ Catalog       â”‚
   â”‚ â€¢ Add WMS       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ GetCapabilities
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   GeoServer     â”‚
   â”‚   WMS Endpoint  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚

4. User Views Map
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Web Browser    â”‚
   â”‚ â€¢ MapStore UI   â”‚
   â”‚ â€¢ Custom App    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚ GetMap Request
            â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   GeoServer     â”‚
   â”‚ â€¢ Auth Check    â”‚
   â”‚ â€¢ Query PostGIS â”‚
   â”‚ â€¢ Render Image  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Database Tables Overview

### gis_carbon (Django + MapStore)

```
Django Tables:
â”œâ”€â”€ people_person (custom user model)
â”œâ”€â”€ people_group
â”œâ”€â”€ api_* (API models)
â”œâ”€â”€ django_session
â””â”€â”€ auth_* (standard Django auth)

MapStore Tables (auto-created):
â”œâ”€â”€ gs_attribute
â”œâ”€â”€ gs_category
â”œâ”€â”€ gs_resource
â”œâ”€â”€ gs_security
â”œâ”€â”€ gs_stored_data
â”œâ”€â”€ gs_user
â””â”€â”€ gs_user_attribute
```

### gis_carbon_data (GeoServer)

```
User-Created Tables:
â”œâ”€â”€ sample_geometries (demo)
â”œâ”€â”€ forest_areas (your data)
â”œâ”€â”€ land_parcels (your data)
â””â”€â”€ ... (your spatial data)

PostGIS System Tables:
â”œâ”€â”€ spatial_ref_sys
â””â”€â”€ geometry_columns
```

## Port Mapping

| Internal Port | External Port | Service | URL |
|--------------|---------------|---------|-----|
| 5432 | 5432 | PostgreSQL | postgresql://localhost:5432 |
| 6379 | 6379 | Redis | redis://localhost:6379 |
| 8000 | 8000 | Django | http://localhost:8000 |
| 8000 | 8001 | FastAPI | http://localhost:8001 |
| 8080 | 8080 | GeoServer | http://localhost:8080/geoserver |
| 8080 | 8082 | MapStore | http://localhost:8082/mapstore |
| 8888 | 8888 | Jupyter | http://localhost:8888 |

## Setup Flow (setup-unified-sso.sh)

```
1. Start Docker Services
   â”œâ”€> Build images (if needed)
   â”œâ”€> Start containers
   â””â”€> Wait for health checks

2. Initialize Databases (automatic)
   â”œâ”€> Create gis_carbon
   â”œâ”€> Create gis_carbon_data
   â”œâ”€> Enable PostGIS
   â””â”€> Create sample tables

3. Configure Authentication
   â”œâ”€> Copy auth services to Django
   â”œâ”€> Copy auth services to FastAPI
   â””â”€> Set shared secrets

4. Setup GeoServer
   â”œâ”€> Wait for GeoServer ready
   â”œâ”€> Inject unified role service
   â”œâ”€> Restart GeoServer
   â”œâ”€> Create workspace: gis_carbon
   â””â”€> Create datastore: gis_carbon_postgis

5. Create Test Users
   â”œâ”€> Django groups (ROLE_AUTHENTICATED, ROLE_ANALYST, ADMIN)
   â”œâ”€> Django users (demo, analyst, admin)
   â””â”€> GeoServer users (via REST API)

6. Verify Setup
   â”œâ”€> Test authentication
   â”œâ”€> Test GeoServer access
   â””â”€> Test layer access
```

## File Structure

```
gis-carbon-ai/
â”œâ”€â”€ docker-compose.dev.yml          # Service orchestration
â”œâ”€â”€ setup-unified-sso.sh            # Automated setup script
â”‚
â”œâ”€â”€ backend/                        # Django application
â”‚   â””â”€â”€ sv_carbon_removal/
â”‚       â”œâ”€â”€ api/auth/              # Authentication endpoints
â”‚       â””â”€â”€ geoserver/             # GeoServer integration scripts
â”‚
â”œâ”€â”€ fastapi-gee-service/           # FastAPI GEE service
â”‚   â””â”€â”€ auth/                      # Auth middleware
â”‚
â”œâ”€â”€ geoserver/
â”‚   â”œâ”€â”€ create-datastore.sh        # Datastore management script
â”‚   â””â”€â”€ config/security/           # Security configuration
â”‚       â””â”€â”€ role/
â”‚           â””â”€â”€ unified_rest_role_service/
â”‚               â””â”€â”€ config.xml     # REST role service config
â”‚
â”œâ”€â”€ mapstore/
â”‚   â”œâ”€â”€ geostore-datasource-ovr-postgres.properties  # DB config
â”‚   â””â”€â”€ localConfig.json           # MapStore configuration
â”‚
â””â”€â”€ postgres/
    â””â”€â”€ init/
        â””â”€â”€ 01-init-databases.sql  # Database initialization
```

## Security Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Unified Role System                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                    â”‚
â”‚  Django Groups (Source of Truth)                  â”‚
â”‚  â”œâ”€â”€ ROLE_ANONYMOUS                               â”‚
â”‚  â”œâ”€â”€ ROLE_AUTHENTICATED                           â”‚
â”‚  â”œâ”€â”€ ROLE_ANALYST                                 â”‚
â”‚  â””â”€â”€ ADMIN                                         â”‚
â”‚       â†“                                            â”‚
â”‚  GeoServer (via REST Role Service)                â”‚
â”‚  â”œâ”€â”€ Calls: /api/auth/geoserver/roles/{username} â”‚
â”‚  â”œâ”€â”€ Secret: X-Role-Secret header                 â”‚
â”‚  â””â”€â”€ Returns: XML <roles>                         â”‚
â”‚       â†“                                            â”‚
â”‚  MapStore (via Django Auth API)                   â”‚
â”‚  â”œâ”€â”€ JWT token authentication                     â”‚
â”‚  â””â”€â”€ Role-based resource access                   â”‚
â”‚       â†“                                            â”‚
â”‚  FastAPI (via JWT middleware)                     â”‚
â”‚  â”œâ”€â”€ Validates JWT signature                      â”‚
â”‚  â””â”€â”€ Extracts user roles                          â”‚
â”‚                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Next Steps

1. âœ… **System is Running** - All services operational
2. ğŸ—ºï¸ **Create Spatial Data** - Add tables to `gis_carbon_data`
3. ğŸ“¢ **Publish Layers** - Use `create-datastore.sh`
4. ğŸ¨ **Style Layers** - Configure in GeoServer
5. ğŸŒ **Add to MapStore** - Create maps and share
6. ğŸ”Œ **Integrate Apps** - Use WMS/WFS/REST APIs

For detailed commands, see:
- `QUICK_START.md`
- `DATABASE_INTEGRATION_SUMMARY.md`

